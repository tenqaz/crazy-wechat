<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>

    <script type="text/javascript"
            src="https://code.jquery.com/jquery-3.4.0.min.js"></script>
    <script type="text/javascript"
            src="//cdnjs.cloudflare.com/ajax/libs/socket.io/1.3.6/socket.io.min.js"></script>
    <script src="/static/js/echarts.min.js"></script>
    <script src="/static/js/charts.js"></script>

    <script type="text/javascript" charset="utf-8">

        namespace = "/wechat"

        var socket;

        function login() {
            socket = io.connect('http://' + document.domain + ':' + location.port + namespace);

            socket.on('connect', function (data) {
                {#socket.emit("message", "i'm comming")#}

                socket.emit("login")
            });

            socket.on('disconnect', function (data) {
                socket.emit("message", "i'm leaving")
            });

            socket.on('login_image', function (data) {
                random_num = Math.random()
                $("#login_image").attr("src", "static/images/login.jpg?" + random_num)
            })

            socket.on('login_status', function (data) {

                if (data == 'success') {
                    $("#login_before").hide()

                    $("#login_after").show()
                }
            })

            socket.on('show_data', function (data) {
                show_data(data)
            })


        }

        function check_friends() {
            var num = 0

            $("#login_after").hide()
            $("#check_friends").show()

            socket.on("friends_num", function (data) {

                $("#all_friends").text(data.friends_num)
            })

            socket.on("check_friends_num", function (data) {
                $("#checking").text(++num)
            })

            socket.on("check_friends", function (data) {
                $("#no_friends").text(data.nofriends)
                $("#black_friends").text(data.black_friends)
            })

            socket.emit('check_friends')
        }

        function show_data_click() {
            socket.emit("show_data")
        }


        function show_data(data) {

            $("#login_after").hide()
            console.log(data)
            show_sex(data['sex'])
            show_province(data['province'])


        }

        $(document).ready(function () {

        });
    </script>
</head>
<body>
<div id="login_before">
    <img id="login_image"/>
    <button onclick="login()">登录</button>
</div>

<div id="login_after" , hidden="True">
    <h1>登录成功</h1>
    <p>检查有哪些好友删除了你或者拉黑了你</p>
    <button onclick="check_friends()">检测</button>
    <p>数据展示</p>
    <button onclick="show_data_click()">展示信息</button>
</div>

<div id="check_friends" , hidden="True">
    <h1>正在检测您的好友<em id="checking">0</em>/<em id="all_friends">0</em></h1>
    <p>已把你删除的有: <em id="no_friends"></em></p>
    <p>已把你拉黑的有: <em id="black_friends"></em></p>
</div>

<div id="sex_charts" style="width:600px;height:400px;float: left;"></div>


</body>

<script>

</script>

</html>